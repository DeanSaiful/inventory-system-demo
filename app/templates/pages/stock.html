{% extends "layouts/dashboard.html" %}

{% block title %}Stock Management{% endblock %}
{% block page_title %}Stock Management{% endblock %}

{% block content %}

<!-- Header -->
<div class="flex justify-between items-center mb-4">
  <h2 class="text-lg font-semibold">Component List</h2>

  {% if current_user.role == "admin" %}
    <button
      onclick="openModal()"
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      + Add Component
    </button>
  {% endif %}
</div>

<!-- Table -->
<div class="bg-white rounded shadow">

<form method="get" action="/stock">
<table class="min-w-full text-xs border-collapse whitespace-nowrap">

  <!-- HEADER ROW -->
  <thead class="bg-gray-100">
    <tr>
      <th class="px-3 py-2 w-28">Category</th>
      <th class="px-3 py-2 w-[300px]">Description</th>
      <th class="px-3 py-2">Value</th>
      <th class="px-3 py-2">Size</th>
      <th class="px-3 py-2">Voltage</th>
      <th class="px-3 py-2">Watt</th>
      <th class="px-3 py-2">Type</th>
      <th class="px-3 py-2">Part No</th>
      <th class="px-3 py-2">Rack</th>
      <th class="px-3 py-2">Location</th>
      <th class="px-3 py-2">Qty</th>
      <th class="px-3 py-2 w-24">Action</th>
    </tr>

    <!-- FILTER ROW -->
    <tr class="bg-white border-t">
      <th class="px-2 py-1">
        <input name="category"
               value="{{ filters.category }}"
               class="w-full border rounded px-2 py-1">
      </th>

      <th>
        <input name="description"
               value="{{ filters.description}}"
               class="w-full border rounded px-2 py-1">
      </th>

      <th>
        <input name="value"
               value="{{ filters.value }}"
               class="w-full border rounded px-2 py-1">
      </th>

      <th>
        <input name="size"
               value="{{ filters.size }}"
               class="w-full border rounded px-2 py-1">
      </th>

      <th>
        <input name="voltage"
               value="{{ filters.voltage }}"
               class="w-full border rounded px-2 py-1">
      </th>

      <th>
        <input name="watt"
               value="{{ filters.watt }}"
               class="w-full border rounded px-2 py-1">
      </th>
      
      <th>
        <input name="type"
               value="{{ filters.type }}"
               class="w-full border rounded px-2 py-1">
      </th>

      <th class="px-2 py-1">
        <input name="part_no"
               value="{{ filters.part_no }}"
               class="w-full border rounded px-2 py-1">
      </th>

      <th class="px-2 py-1">
        <input name="rack"
               value="{{ filters.rack }}"
               class="w-full border rounded px-2 py-1">
      </th>

      <th class="px-2 py-1">
        <input name="location"
               value="{{ filters.location }}"
               class="w-full border rounded px-2 py-1">
      </th>

      <th></th>

      <th class="px-2 py-1">
        <button class="bg-blue-600 text-white px-3 py-1 rounded text-xs">
          Filter
        </button>
      </th>
    </tr>
  </thead>

  <!-- DATA ROWS -->
  <tbody class="divide-y">
    {% for c in components %}
    <tr class="hover:bg-gray-50">
        <td class="px-3 py-2">{{ c.category }}</td>
        <td class="px-3 py-2">{{ c.description }}</td>
        <td class="px-3 py-2 text-center">{{ c.value or "-" }}</td>
        <td class="px-3 py-2 text-center">{{ c.size or "-" }}</td>
        <td class="px-3 py-2 text-center">{{ c.voltage or "-" }}</td>
        <td class="px-3 py-2 text-center">{{ c.watt or "-" }}</td>
        <td class="px-3 py-2 text-center">{{ c.type or "-" }}</td>
        <td class="px-3 py-2 text-center">{{ c.part_no }}</td>
        <td class="px-3 py-2 text-center">{{ c.rack }}</td>
        <td class="px-3 py-2 text-center">{{ c.location }}</td>
        <td class="px-3 py-2 text-center font-semibold">{{ c.quantity }}</td>

        <td class="px-3 py-2 text-center space-x-2">
        {% if current_user.role == "admin" %}

        <!-- EDIT (NO FORM SUBMIT) -->
        <a href="/stock/edit/{{ c.id }}"
          class="text-blue-600 hover:underline">
          ‚úèÔ∏è
        </a>


        <!-- DELETE (FORM SUBMIT OK) -->
        <form method="post"
              action="/stock/delete/{{ c.id }}"
              class="inline"
              onsubmit="return confirm('Delete this component?');">
          <button type="submit" class="text-red-600">
            üóëÔ∏è
          </button>
        </form>

        {% else %}
        -
        {% endif %}
        </td>

    </tr>
    {% else %}
    <tr>
      <td colspan="12" class="text-center py-4 text-gray-500">
        No components found
      </td>
    </tr>
    {% endfor %}
  </tbody>

</table>
</form>

</div>


<!-- MODAL -->
<div id="addModal"
     class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">

  <div class="bg-white rounded-lg w-full max-w-3xl p-6 relative">

    <h3 class="text-xl font-semibold mb-4">Add New Component</h3>

    <form method="post" action="/stock/add" enctype="multipart/form-data"
          class="grid grid-cols-2 gap-4">

      <input name="category" placeholder="Category (required)" required class="input">
      <input name="description" placeholder="Description (required)" required class="input">

      <input name="value" placeholder="Value" class="input">
      <input name="size" placeholder="Size" class="input">

      <input name="voltage" placeholder="Voltage" class="input">
      <input name="watt" placeholder="Watt" class="input">

      <input name="type" placeholder="Type" class="input">
      <input name="part_no" placeholder="Part No (required)" class="input">

      <input name="rack" placeholder="Rack" class="input">
      <input name="location" placeholder="Location" class="input">

      <input name="quantity" type="number" placeholder="Qty (required)" required class="input">

      <input name="image" type="file" accept="image/*"
             class="col-span-2 border rounded px-3 py-2">

      <div class="col-span-2 flex justify-end gap-2 mt-4">
        <button type="button" onclick="closeModal()"
                class="px-4 py-2 border rounded">
          Cancel
        </button>
        <button class="bg-blue-600 text-white px-4 py-2 rounded">
          Save
        </button>
      </div>

    </form>
  </div>
</div>

<!-- EDIT MODAL -->
<div id="editModal"
     class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">

  <div class="bg-white rounded-lg w-full max-w-3xl p-6 relative">
    <h3 class="text-xl font-semibold mb-4">Edit Component</h3>

    <div id="editModalContent"></div>

    <form id="editForm"
          method="post"
          enctype="multipart/form-data"
          class="grid grid-cols-2 gap-4">

      <input name="category" id="e_category" class="input" required>
      <input name="description" id="e_description" class="input" required>

      <input name="value" id="e_value" class="input">
      <input name="size" id="e_size" class="input">

      <input name="voltage" id="e_voltage" class="input">
      <input name="watt" id="e_watt" class="input">

      <input name="type" id="e_type" class="input">
      <input name="part_no" id="e_part_no" class="input" required>

      <input name="rack" id="e_rack" class="input">
      <input name="location" id="e_location" class="input">

      <input name="quantity" id="e_quantity" type="number" class="input" required>

      <input name="image" type="file" class="col-span-2">

      <div class="col-span-2 flex justify-end gap-2">
        <button type="button" onclick="closeEditModal()" class="border px-4 py-2 rounded">
          Cancel
        </button>
        <button class="bg-blue-600 text-white px-4 py-2 rounded">
          Update
        </button>
      </div>
    </form>
  </div>
</div>


<!-- Simple styles -->
<style>
  .input {
    border: 1px solid #d1d5db;
    padding: 0.5rem;
    border-radius: 0.375rem;
    width: 100%;
  }
</style>

<!-- Modal JS -->
<script>
  function openModal() {
    document.getElementById("addModal").classList.remove("hidden");
    document.getElementById("addModal").classList.add("flex");
  }

  function closeModal() {
    document.getElementById("addModal").classList.add("hidden");
    document.getElementById("addModal").classList.remove("flex");
  }
</script>

<script>
function openEditModal() {
  document.getElementById("editModal").classList.remove("hidden");
  document.getElementById("editModal").classList.add("flex");
}


function closeEditModal() {
  document.getElementById("editModal").classList.add("hidden");
  document.getElementById("editModal").classList.remove("flex");
}
</script>


{% endblock %}
